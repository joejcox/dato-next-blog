// api
import { request } from "../lib/datocms"
import { HOMEPAGE_QUERY } from "../graph-queries"

// react
import { useRef } from "react"

// content
import Head from "next/head"
import { Image } from "react-datocms"
import ReactMarkdown from "react-markdown"
import HeadingAnimation from "../components/animations/HeadingAnimation"
// import MainContent from "../components/MainContent"

export default function Home({ content: { homePage } }) {
  const introRef = useRef(null)
  const {
    heading: {
      value: {
        document: { children },
      },
    },
  } = homePage

  const headingStart = children[0].children[0].value
  const headingSpan = children[1].children[0].value
  const headingEnd = children[2].children[0].value

  return (
    <>
      <Head>
        <title>
          Swiftweb Digital | Professional website development served swiftly
        </title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <article className="w-full h-full max-h-screen min-h-[500px] overflow-hidden relative">
        <section className="overlay">
          <div className="container">
            <div className="banner-content">
              <h1 className="banner-title">
                {headingStart}
                <br />
                <span className="highlight">{headingSpan}</span> {headingEnd}
              </h1>
              <h2 className="strapline">{homePage.strapline}</h2>
            </div>
          </div>
        </section>
        <figure className="h-screen bg-grey-200">
          <Image
            src={homePage.bannerImage.url}
            data={homePage.bannerImage.responsiveImage}
            alt={homePage.bannerImage.alt}
            objectFit="cover"
            layout="fill"
            lazyload="true"
          />
        </figure>
      </article>
      <article
        className="bg-white h-screen flex items-center intro"
        ref={introRef}
      >
        <div className="container">
          <HeadingAnimation heading={homePage.introHeading} />
          <HeadingAnimation heading={homePage.introHeadingTwo} />
          <div className="markdown">
            <ReactMarkdown>{homePage.introParagraph}</ReactMarkdown>
          </div>
        </div>
      </article>
    </>
  )
}

export async function getServerSideProps() {
  const content = await request({
    query: HOMEPAGE_QUERY,
  })
  return {
    props: { content },
  }
}
